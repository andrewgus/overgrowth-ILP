---
import '../styles/libraryPages.scss'
import LibLayout from '../layouts/LibLayout.astro'

export async function getStaticPaths() {
	const allLessons = await Astro.glob('./*/*.astro')

	const topicURLs = allLessons.map((lesson) => lesson.url!.split('/').at(2))

	return topicURLs.map((topic) => {
		const filteredLessons = allLessons.filter((lesson) =>
			lesson.url?.includes(topic!)
		)

		const topicTitle = topic!
			.split('-')
			.map((word) => word.charAt(0).toUpperCase() + word.slice(1))
			.join(' ')

		return {
			params: { topic },
			props: { filteredLessons, topicTitle },
		}
	})
}

const { filteredLessons, topicTitle } = Astro.props
---

<LibLayout title={`${topicTitle!} InteractiveÂ Lessons`} isTopicsPage>
	<p>Select one of the available lessons&hellip;</p>
	<ul class='cardGrid'>
		{
			filteredLessons.map((fL: { url: string }) => (
				<li>
					<a class='linkCard' href={fL.url}>
						<span>
							{fL.url
								.split('/')
								.at(-1)!
								.split('-')
								.map((word) => word.charAt(0).toUpperCase() + word.slice(1))
								.join(' ')}
						</span>
					</a>
				</li>
			))
		}
	</ul>
</LibLayout>
